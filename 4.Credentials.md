# *Credentials*

*In order to receive and store credential locally, we will need to follow 2 set of steps:* 

1. [**Accept credential offer**](#1-accept-credential-offer)
2. [**Receive and generate credential**](#2-receive-and-generate-credential)

--- 

### Credentials Flow
*![](wiki-images/AcceptingCredentialOffer.png)*

--- 
## *1. Accept credential offer*

*After receiving push notification with credential offer object, it's necessary to follow next steps to accept credential offer:* 

### 1. De-serialize connection

##### iOS

```ObjC
[[sdkAPI] connectionDeserialize: serializedConnection completion:^(NSError *error, NSInteger connectionHandle) {
// handle errors first
}
```


#### Android

```java
ConnectionApi.connectionDeserialize(serializedConnection)
    .exceptionally((t) -> {
        // hadle error response
        return -1;
    }).thenAccept(result -> {
        if (result != -1) {
            // handle successful result
        }
    });
```


### *2. Create credential with messageID* 

#### iOS 

```ObjC 
[[sdkAPI] credentialCreateWithMsgid: messageId 
    connectionHandle: (int)connectionHandle 
    msgId: messageId 
    completion: ^(NSError *error, NSInteger credentialHandle, NSString* credentialOffer) {
    // handle errors first
    //... proceed with next step
}
```

#### Android

```java
CredentialApi.credentialCreateWithMsgid(sourceId, connectionHandle, messageId)
    .exceptionally((t) -> {
        // hadle error response
        return null;
    }).thenAccept(result -> {
        GetCredentialCreateMsgidResult typedResult = (GetCredentialCreateMsgidResult) result;
        WritableMap vcxCredentialCreateResult = Arguments.createMap();
        vcxCredentialCreateResult.putInt("credential_handle", typedResult.getCredential_handle());
        vcxCredentialCreateResult.putString("credential_offer", typedResult.getOffer());
        // handle successful result
    });
```


### *3. Serialize credential* 

#### iOS 
```ObjC
[[sdkAPI] credentialSerialize:credentialHandle 
    completion:^(NSError *error, NSString *claimOffer) {
// handle errors first
//... proceed with next step
}
```


#### Android

```java
CredentialApi.credentialSerialize(credentialHandle)
    .exceptionally((t) -> {
        // hadle error response
        return null;
    }).thenAccept(result -> {
        // handle successful result
    });
```

### *4. Get state for credential* 

#### iOS 
```ObjC
[[sdkAPI] credentialGetState:credentialHandle 
    completion:^(NSError *error, NSInteger state) {
// handle errors first
//... proceed with next step
}
```


#### Android

```java
CredentialApi.credentialGetState(credentialHandle)
    .exceptionally((t) -> {
        // hadle error response
        return -1;
    }).thenAccept(result -> {
        if (result != -1) {
        // handle successful result
        }
    });
```

### *5. De-serialize credential*

#### iOS 
```ObjC
[[sdkAPI] credentialDeserialize: serializedCredential_cString 
    completion: ^(NSError *error, NSInteger credentialHandle) {
// handle errors first
//... proceed with next step
}
```


#### Android

```java
CredentialApi.credentialDeserialize(serializedCredential)
    .exceptionally((t) -> {
        // hadle error response
        return -1;
    }).thenAccept(result -> {
        if (result != -1) {
            // handle successful result
        }
    });
```

### *6. Send credential request* 

#### iOS 
```ObjC
[[sdkAPI] credentialSendRequest: credentialHandle connectionHandle: (int)connectionHandle paymentHandle: 0 completion: ^(NSError *error) {
// handle errors first
//... proceed with next step
}
```

#### Android

```java
CredentialApi.credentialSendRequest(credentialHandle, connectionHandle, paymentHandle)
    .exceptionally((t) -> {
        // hadle error response
        return null;
    }).thenAccept(result -> {
        // handle successful result
    });

```

## 2. Receive and generate credential

### 1. Serialize credential

#### iOS 
```ObjC
[[sdkAPI]  credentialSerialize:credentialHandle completion:^(NSError *error, NSString *claimOffer) {
// handle errors first
//... proceed with next step
}
```

#### Android

```java
 CredentialApi.credentialSerialize(credentialHandle)
    .exceptionally((t) -> { 
        // hadle error response
        return null;
    }).thenAccept(result -> {
        // handle successful result
    });

```

### 2. Get state for credential

#### iOS 
```ObjC
[[sdkAPI]  credentialGetState:credentialHandle completion:^(NSError *error, NSInteger state) {
// handle errors first
//... proceed with next step
}
```


#### Android

```java
CredentialApi.credentialGetState(credentialHandle)
    .exceptionally((t) -> {
        // hadle error response
        return -1;
    }).thenAccept(result -> {
        if (result != -1) {
            // handle successful result
        }
    });
```

### 3. Update credential state

#### iOS 
```ObjC
[[sdkAPI] credentialUpdateState: credentialHandle completion: ^(NSError *error, NSInteger state) {
// handle errors first
//... proceed with next step
}
```

#### Android

```java
CredentialApi.credentialUpdateState(credentialHandle)
    .exceptionally((t) -> {
        // handle error response
            return -1;
    })
    .thenAccept(result -> {
        if (result != -1) {
            // handle success message
        }
    });
```

### *4. Get credential 

#### iOS 
```ObjC
[[sdkAPI] getCredential: credentialHandle completion: ^(NSError *error, NSString *credential) {
// handle errors first
...
}
```


#### Android

```java
CredentialApi.getCredential(credentialHandle)
    .exceptionally((t) -> {
        // handle error response
        return null;
    }).thenAccept(result -> {
        // handle success message
    });
```

At the end, you can store credential locally on user device
