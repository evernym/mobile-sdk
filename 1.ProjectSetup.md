**Prerequisites**

* Development environment:
  * iOS: Xcode
  * Android: Android Studio
  * Installed CocoaPods Gem for Ruby. [Install here](https://cocoapods.org)
<!--[Q1] * Any other packages before creating the project?-->

We also prepared example code for your easy start: please check out the **/Examples** folder in this repository. You will find both projects for both platforms (iOS and Android) and in languages you need (iOS: ObjC or Swift; Android: Java or Kotlin). 

# Project Setup

To complete this section:
1. [Create a new project](#new-project)
2. [Add dependency libraries](#libraries)
3. [Initialize the SDK API (VCX library)](#initialize)
4. [Error types in VCX](#errors)

<a id="new-project"></a>
## 1. Create a new project

### iOS 

1. Create a new Xcode project using the Xcode New Project wizard. If you have an existing project, skip to [Step 2](#2-add-dependency-libraries).

   * From the template list choose **Single View App** and click **Next**.

   * Enter a project name and select your preferred language: **Objective C** or **Swift**. (Leave **Use Core Data** unselected.)

   * In a new window select the folder where you would like to store your project and click **Create**. This directory is the *project directory*.
   
2. In a terminal navigate to the project directory:

``` 
cd <project directory path>
ls -l
```
   The directory should contain one of these files: <!--[Q5] One of these files or both files?-->
   * `<project_name>.xcodeproj`
   * `<project_name>.xcworkspace`

### Android

Use an existing Android Studio project or create a new Android Studio project using the Android Studio New Project wizard. Instructions are available <a href='https://developer.android.com/training/basics/firstapp/creating-project' target="_blank">here</a>
* During the setup of the project you can choose either Java or Kotlin as the language for your new project.
---

<a id="libraries"></a>

## 2. Add dependency libraries

### iOS

1. Verify that you have CocoaPods. If you do not, run `sudo gem install cocoapods`

2. Verify that there is a Podfile in the project directory or create new one by running `pod init` in terminal, in the project folder. In case you started with existing project, most probably you already have Podfile in place other library dependencies. 

3. From this repo, copy vcx.podspec file to your project root folder and add it's path to your Podfile. Open Podfile in any editor and add this line: 

```ruby
  pod 'vcx', :path => 'path_to_project_folder/vcx.podspec'
```

4. It is also important to use one of the latest library versions, which you can find using this link: <a href="https://github.com/evernym/mobile-sdk/releases" target="_blank">https://github.com/evernym/mobile-sdk/releases</a>. From list of versions, press **Assets** link bellow choosen version and right click > copy url for "vcx.libvcxall_*versionNumber*_universal.zip". 
   
   > For example: Release Version 15590 has VCX library named: vcx.libvcxall_0.7.69722834-fb364dde0_universal.zip and url path to the zip is this one: https://github.com/evernym/mobile-sdk/releases/download/15590/vcx.libvcxall_0.7.69722834-fb364dde0_universal.zip
   
- Download file to your local disk (in this example we stored it in mobileSDK root folder).
- After downloading file, unzip downloaded library into vcx folder in same directory with vcx.podspec file. After that you will need to update vcx.podspec file (in any editor) by updating path to the file, line 14, for **s.source** attribute:

> vcx.podspec: 
> 
> (In our example, file is stored in the same folder with vcx.podspec, mobileSDK root folder)
```ruby 
    s.source = { :http => 'file:' + __dir__ + '/vcx.libvcxall_0.7.69722834-fb364dde0_universal.zip' } 
```

 - Also, update version number to match release version from which you copied vcx zip file to **s.version** attribute. For release version **15590**, pod s.version will be **0.0.155**.
  
>  So final podspec after changes should look like this: 

```ruby
Pod::Spec.new do |s|
  s.name             = 'vcx'
  s.version          = '0.0.165' # version number from release number in git repository, curently latest one is 16506 > 0.0.165
  s.summary          = 'The Objective-C wrapper around the libvcx shared library.'

  s.description      = <<-DESC
The ConnectMe mobile app on the iOS platform will call into the libvcx shared library
from Objective-C. This pod is a very thin Objective-C wrapper that allows react native to call
through to the libvcx shared library. 
                       DESC

  s.homepage         = 'https://www.evernym.com/'
  s.author           = { 'evernym-ios-dev' => 'iosdev@evernym.com' }
    s.source           = { :http => 'file:' + __dir__ + '/vcx.libvcxall_0.7.69722834-fb364dde0_universal.zip' } # path to the file in this example is set to mobile sdk code root folder, pls. update if necessary

  s.ios.deployment_target = '8.0'
  s.ios.vendored_frameworks="vcx/vcx.framework"
  s.compiler_flags = '-ObjC'
  s.public_header_files = 'vcx/vcx.framework/include/*.h'
  s.ios.vendored_library = 'vcx/vcx.framework/lib/libvcx.a'
end
```
Your vcx fodler, after unpacking zip should have this structure: 

  - vcx.podspec
  - evernym.vcx-sdk.git.commit.log
  - vcx.framework
    - _CodeSignature
    - Headers
    - Info.plist
    - lib
    - Modules
    - vcx

> Save `vcx.podspec` and Podfile documents. 

1. Run `pod install --repo-update`

This command will download the required VCX library to your local folder and include it in the project. The VCX library is around 60 MB, so command execution could take a few minutes.

6. Run the project

Verify that `<project_name>.xcworkspace` exists in the project directory. Use *only* that file to open your project and edit your source code in Xcode. *Do not* use the `<project_name>.xcodeproj` file to open or edit your project, but donâ€™t delete it, either.   


7. Link VCX library in Xcode project

- If you are using Swift, you must create an `Objective-C` bridging header file named `<project_name>-Bridging-Header.h` in the same directory as your `AppDelegate.swift` file. Add it to your Xcode project using the **File > New > File** menu item of the Xcode IDE: 

    * In the wizard that launches, select **iOS > Header File** and then click **Next**. 
    * In the **Save As** field enter `<project_name>-Bridging-Header.h`
    * Select the **<project_name> Group**.
    * Select the **<project_name> Targets** and click **Create**. 
  
  Now `<project_name>-Bridging-Header.h` should be listed in the Xcode IDE at the same level as `AppDelegate.swift`. 

  Edit `<project_name>-Bridging-Header.h` in the Xcode IDE and make sure it has the following lines: 

```ObjC
// filename: <project_name>_Bridging_Header_h

#ifndef <project_name>_Bridging_Header_h
#define <project_name>_Bridging_Header_h

#import "vcx/vcx.h"

#endif
```

- If you are using `Objective-C`, edit `AppDelegate.h` to add the following to the `imports` section of the file:

```ObjC
// filename: AppDelegate.h

#import "vcx/vcx.h"
```

### Android

1. Open the project-level `build.gradle` file, which contains the declaration of the repositories. Add the following to the `allprojects` repositories section (not the `buildscript` repositories section): <!--[Q17] Is the section name "allprojects repositories"? Is there a "buildscript repositories" section?-->
    
```java
maven {
    url 'https://evernym.mycloudrepo.io/public/repositories/libvcx-android'
}
```

2. Open the app-level `build.gradle` file and add the following to the dependencies section.

```java
implementation 'com.evernym:vcx:0.2.43551129-6fc40e0@aar'
```

3. Change `minSdkVersion` to be at least `23`. Do not use a smaller version number.

4. Try to build your project in Android Studio to make sure the changes you have made so far are valid. Evernym recommends that you launch your mobile app in an emulator to make sure that the bundling of the APK is working.

---

<a id="initialize"></a>

## 3. Initialize the SDK API

### iOS


Two `AppDelegate` data members must be declared in `AppDelegate.h`  and then initialized in `AppDelegate.m`:
* `self.sdkApi`
* `self.sdkInited`     

1. In `AppDelegate.h` add this declaration:
```c
@property (strong, nonatomic) ConnectMeVcx *sdkApi;
@property (nonatomic) BOOL sdkInited;
```

2. In `AppDelegate.m` add this synthesize statement and this constructor or initer: 
```c 
@synthesize sdkInited;

//
// further down in AppDelegate.m
// ...
- (id)init
{
self = [super init];
if (self) {
    // Initialization code here.
    self.sdkApi = [[ConnectMeVcx alloc] init];
    self.sdkInited = false;
}

return self;
}
```        

3. Try to build your project in Xcode to make sure the changes you have made so far are valid. Evernym recommends that you launch your mobile app in a simulator to make sure that the linking and deploying steps work as well. 

4. You are now ready to start adding calls to your code to [initialize the wallet](InitializingTheWallet.md). <!--link broken-->

### Android

<!-- [Q18] Is this a duplicate section or are they creating a whole new project? "You should have an existing Android Studio project or create a new Android Studio project using the Android Studio new project wizard. Instructions are available <a href='https://developer.android.com/training/basics/firstapp/creating-project' target="_blank">here</a>
- During the setup of the project you can choose either Java or Kotlin as the language for your new project." -->
1. Open the project-level `build.gradle` file that contains the declaration of the repositories and add the following to the `allprojects` repositories section (not the `buildscript` repositories section).
    
```java
maven {
    url 'https://evernym.mycloudrepo.io/public/repositories/libvcx-android'
}
```
    
2. Open the app-level `build.gradle` file and add the following to the `dependencies` section. <!--[Q19] Is the section explicitly called "dependencies" or is that just a description of the section?-->

```java
implementation 'com.evernym:vcx:0.2.43551129-6fc40e0@aar'
```

3. Change `minSdkVersion` to be at least `23`. Do not use a smaller version number.

4. Try to build your project in Android Studio to make sure the changes you have made so far are valid. Evernym recommends that you launch your mobile app in an emulator to make sure that the bundling of the APK is working.

<!--- [Q20] Will this section be included for the beta? TODO: Initialize self.sdkApi and self.sdkInited for android?...  mobile-starter-master/android/CMeSdkJava/app/src/main/java/me/connect/sdk/java/MainActivity.java-->

5. You are now ready to start adding calls to your code to [initialize the wallet](InitializingTheWallet.md). <!--link broken-->

<a id="errors"></a>

## 3. VCX Error definition

In communication with cloud agent and VCX library, it is possible you will stumble upon some errors. In order to better understand what those errors mean, here is the list of all error codes you can get: 

- Success: 0
- IndyInvalidWalletHandle: 200,
- IndyWalletRecordNotFound: 212
- IndyDuplicateWalletRecord:  213
- UnknownError:  1001
- ConnectionError:  1002
- InvalidConnectionHandle:  1003
- InvalidConfiguration:  1004
- NotReady:  1005
- NoEndpoint:  1006
- InvalidOption:  1007
- InvalidDid:  1008
- InvalidVerkey:  1009
- CouldNotConnect:  1010
- InvalidNonce:  1011
- InvalidKeyDelegate:  1012
- InvalidUrl:  1013
- NotBase58:  1014
- InvalidIssuerCredentialHandle:  1015
- InvalidJson:  1016
- InvalidProofHandle:  1017
- InvalidCredentialRequest:  1018
- InvalidMessagePack:  1019
- InvalidMessages:  1020
- InvalidAttributesStructure:  1021
- BigNumberError:  1022
- InvalidProof:  1023
- InvalidGenesisTxnPath:  1024
- PoolLedgerConnect:  1025
- CreatePoolConifg:  1026
- InvalidProofCredentialData:  1027
- IndySubmitRequestError:  1028
- BuildCredentialDefReqErr:  1029
- NoPoolOpen:  1030
- InvalidSchema:  1031
- FailedPoolCompliance:  1032
- InvalidHttpResponse:  1033
- CreateCredentialDefErr:  1034
- UnknownLibindyError:  1035
- InvalidCredentialDef:  1036
- InvalidCredentialDefHandle:  1037
- TimeoutLibindyError:  1038
- CredentialDefAlreadyCreated:  1039
- InvalidSchemaSequenceNumber:  1040
- InvalidSchemaCreation:  1041
- InvalidSchemaHandle:  1042
- InvalidMasterSecret:  1043
- AlreadyInitialized:  1044
- InvalidInviteDetails:  1045
- InvalidSelfAttestedVal:  1046
- InvalidPredicate:  1047
- InvalidObjHandle:  1048
- InvalidDisclosedProofHandle:  1049
- SerializationError:  1050
- WalletAlreadyExists:  1051
- WalletAlreadyOpen:  1052
- InvalidCredentialHandle:  1053
- InvalidCredentialJson:  1054
- CreateCredentialFailed:  1055
- CreateProofError:  1056
- InvalidWalletHandle:  1057
- InvalidWalletCreation:  1058
- InvalidPoolName:  1059
- CannotDeleteConnection:  1060
- CreateConnectionError:  1061
- InvalidWalletSetup:  1062
- CommonError:  1063
- InsufficientTokenAmount:  1064
- UnknownTxnType:  1065
- InvalidPaymentAddress:  1066
- InvalidLibindyParam:  1067
- InvalidPayment:  1068
- MissingWalletKey:  1069
- ObjectCacheError:  1070
- NoPaymentInformation:  1071
- DuplicateWalletRecord:  1072
- WalletRecordNotFound:  1073
- IOError:  1074
- WalletAccessFailed:  1075
- MissingWalletName:  1076
- MissingExportedWalletPath:  1077
- MissingBackupKey:  1078
- WalletNotFound:  1079
- LibindyInvalidStructure:  1080
- InvalidState:  1081
- InvalidLedgerResponse:  1082
- DidAlreadyExistsInWallet:  1083
- DuplicateMasterSecret:  1084
- ThreadError:  1085
- InvalidProofRequest:  1086
- MissingPaymentMethod:  1087
- DuplicateSchema:  1088
- UnknownLibindyRejection:  1089
- LoggingError:  109
- InvalidRevocationDetails:  1091
- InvalidRevEntry:  1092
- InvalidRevocationTimestamp:  1093
- UnknownSchemaRejection:  1094
- InvalidRevRegDefCreation:  109
- InvalidAttachmentEncoding:  1100
- UnknownAttachmentEncoding:  1101
- UnknownMimeType:  1102
- ActionNotSupported:  1103
- InvalidRedirectDetails:  1104
- NoAgentInfo:  1106
  